# Alerting Rules ESSENCIAIS para Demonstração de Tolerância a Falhas
# APENAS os alertas necessários para a demo
groups:
  - name: patocash_demo_alerts
    interval: 15s
    rules:
      # Para demonstrar HPA - CPU alta acionando escalonamento
      - alert: PatoCashHPATriggered
        expr: patocash:backend_total_cpu_percent > 50
        for: 30s
        labels:
          severity: info
          demo: hpa-scaling
        annotations:
          summary: "🚀 HPA acionado - CPU alta detectada"
          description: "CPU total do backend está em {{ $value }}%. HPA deve escalonar pods automaticamente."

      # Para demonstrar HPA - Escalonamento ativo
      - alert: PatoCashHPAScaling
        expr: patocash:hpa_current_replicas > 2
        for: 15s
        labels:
          severity: info
          demo: hpa-scaling
        annotations:
          summary: "📈 HPA escalonando - {{ $value }} replicas ativas"
          description: "HPA aumentou o número de replicas para {{ $value }} devido ao aumento de CPU."

      # Para demonstrar Auto-healing - Pod sendo recriado
      - alert: PatoCashPodCountChanged
        expr: changes(patocash:backend_pod_count[2m]) != 0
        for: 10s
        labels:
          severity: info
          demo: auto-healing
        annotations:
          summary: "🔄 Auto-healing detectado - mudança no número de pods"
          description: "Número de pods backend mudou para {{ $value }}. Kubernetes está fazendo auto-healing."